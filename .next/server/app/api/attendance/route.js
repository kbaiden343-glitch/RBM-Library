"use strict";(()=>{var e={};e.id=996,e.ids=[996],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3669:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{GET:()=>c,POST:()=>d});var a=r(9303),s=r(8716),o=r(670),i=r(7070),u=r(2663);async function c(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),n=parseInt(t.get("limit")||"10"),a=t.get("memberId")||"",s=t.get("date")||"",o=(r-1)*n,c={};if(a&&(c.memberId=a),s){let e=new Date(s),t=new Date(s);t.setDate(t.getDate()+1),c.checkInTime={gte:e,lt:t}}let[d,l]=await Promise.all([u._.attendance.findMany({where:c,skip:o,take:n,orderBy:{checkInTime:"desc"},include:{person:!0,member:!0}}),u._.attendance.count({where:c})]);return i.NextResponse.json({attendance:d,pagination:{page:r,limit:n,total:l,pages:Math.ceil(l/n)}})}catch(e){return console.error("Get attendance error:",e),i.NextResponse.json({error:"Failed to fetch attendance"},{status:500})}}async function d(e){try{let{action:t,personId:r,memberId:n,visitorName:a,visitorEmail:s,visitorPhone:o}=await e.json();if("check-in"===t){if(r){let e=await u._.person.findUnique({where:{id:r}});if(!e)return i.NextResponse.json({error:"Person not found"},{status:404});if("ACTIVE"!==e.status)return i.NextResponse.json({error:"Person is not active"},{status:400});let t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1);if(await u._.attendance.findFirst({where:{personId:r,checkInTime:{gte:n,lt:a},checkOutTime:null}}))return i.NextResponse.json({error:"Person is already checked in today"},{status:409});let s=await u._.attendance.create({data:{personId:r,isVisitor:"VISITOR"===e.personType},include:{person:!0}});return i.NextResponse.json(s,{status:201})}if(n){let e=await u._.member.findUnique({where:{id:n}});if(!e)return i.NextResponse.json({error:"Member not found"},{status:404});if("ACTIVE"!==e.status)return i.NextResponse.json({error:"Member is not active"},{status:400});let t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1);if(await u._.attendance.findFirst({where:{memberId:n,checkInTime:{gte:r,lt:a},checkOutTime:null}}))return i.NextResponse.json({error:"Member is already checked in today"},{status:409});let s=await u._.attendance.create({data:{memberId:n,isVisitor:!1},include:{member:!0}});return i.NextResponse.json(s,{status:201})}{if(!a||!s)return i.NextResponse.json({error:"Visitor name and email are required"},{status:400});let e=await u._.attendance.create({data:{visitorName:a,visitorEmail:s,visitorPhone:o||null,isVisitor:!0}});return i.NextResponse.json(e,{status:201})}}if("check-out"!==t)return i.NextResponse.json({error:'Invalid action. Use "check-in" or "check-out"'},{status:400});{let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1),o={checkInTime:{gte:t,lt:a},checkOutTime:null};if(r)o.personId=r;else if(n)o.memberId=n;else{if(!s)return i.NextResponse.json({error:"Person ID, Member ID, or visitor email is required for check-out"},{status:400});o.visitorEmail=s,o.isVisitor=!0}let c=await u._.attendance.findFirst({where:o,include:{person:!0,member:!0}});if(!c)return i.NextResponse.json({error:"No active check-in found for today"},{status:404});let d=await u._.attendance.update({where:{id:c.id},data:{checkOutTime:new Date},include:{person:!0,member:!0}});return i.NextResponse.json(d,{status:200})}}catch(e){return console.error("Attendance operation error:",e),i.NextResponse.json({error:"Failed to process attendance"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/attendance/route",pathname:"/api/attendance",filename:"route",bundlePath:"app/api/attendance/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\Library Project\\app\\api\\attendance\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:h}=l,g="/api/attendance/route";function f(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},2663:(e,t,r)=>{r.d(t,{_:()=>a});let n=require("@prisma/client"),a=globalThis.prisma??new n.PrismaClient({log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(3669));module.exports=n})();