"use strict";(()=>{var e={};e.id=506,e.ids=[506],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9901:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>R,patchFetch:()=>k,requestAsyncStorage:()=>b,routeModule:()=>c,serverHooks:()=>_,staticGenerationAsyncStorage:()=>h});var o={};t.r(o),t.d(o,{DELETE:()=>m,GET:()=>l,PUT:()=>p});var s=t(9303),n=t(8716),a=t(670),i=t(7070),d=t(2663),u=t(971);async function l(e,{params:r}){try{let e=await d._.book.findUnique({where:{id:r.id},include:{borrowings:{include:{member:!0}},reservations:{include:{member:!0}}}});if(!e)return i.NextResponse.json({error:"Book not found"},{status:404});return i.NextResponse.json(e)}catch(e){return console.error("Get book error:",e),i.NextResponse.json({error:"Failed to fetch book"},{status:500})}}async function p(e,{params:r}){try{let t=await e.json(),o={...t,id:r.id,coverImage:""===t.coverImage?null:t.coverImage,description:""===t.description?null:t.description},s=u.mC.parse(o),n=await d._.book.findUnique({where:{id:r.id}});if(!n)return i.NextResponse.json({error:"Book not found"},{status:404});if(s.isbn&&s.isbn!==n.isbn&&await d._.book.findUnique({where:{isbn:s.isbn}}))return i.NextResponse.json({error:"Book with this ISBN already exists"},{status:409});let a=await d._.book.update({where:{id:r.id},data:{...s,coverImage:s.coverImage||null,description:s.description||null},include:{borrowings:!0,reservations:!0}});return i.NextResponse.json(a)}catch(e){if(console.error("Update book error:",e),e instanceof Error&&"ZodError"===e.name)return i.NextResponse.json({error:"Invalid input data"},{status:400});return i.NextResponse.json({error:"Failed to update book"},{status:500})}}async function m(e,{params:r}){try{let e=await d._.book.findUnique({where:{id:r.id},include:{borrowings:{where:{status:"BORROWED"}},reservations:{where:{status:"WAITING"}}}});if(!e)return i.NextResponse.json({error:"Book not found"},{status:404});if(e.borrowings.length>0)return i.NextResponse.json({error:"Cannot delete book that is currently borrowed"},{status:400});if(e.reservations.length>0)return i.NextResponse.json({error:"Cannot delete book that has pending reservations"},{status:400});return await d._.book.delete({where:{id:r.id}}),i.NextResponse.json({message:"Book deleted successfully"})}catch(e){return console.error("Delete book error:",e),i.NextResponse.json({error:"Failed to delete book"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/books/[id]/route",pathname:"/api/books/[id]",filename:"route",bundlePath:"app/api/books/[id]/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\Library Project\\app\\api\\books\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:b,staticGenerationAsyncStorage:h,serverHooks:_}=c,R="/api/books/[id]/route";function k(){return(0,a.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:h})}},2663:(e,r,t)=>{t.d(r,{_:()=>s});let o=require("@prisma/client"),s=globalThis.prisma??new o.PrismaClient({log:["error"]})},971:(e,r,t)=>{t.d(r,{AY:()=>a,Bs:()=>d,Z5:()=>p,dm:()=>s,gY:()=>n,lA:()=>u,mC:()=>i,oO:()=>l});var o=t(8879);let s=o.Ryn({email:o.Z_8().email("Invalid email address"),password:o.Z_8().min(6,"Password must be at least 6 characters")}),n=o.Ryn({name:o.Z_8().min(2,"Name must be at least 2 characters"),email:o.Z_8().email("Invalid email address"),password:o.Z_8().min(6,"Password must be at least 6 characters"),role:o.KmV(["ADMIN","LIBRARIAN","MEMBER"]).optional()}),a=o.Ryn({title:o.Z_8().min(1,"Title is required"),author:o.Z_8().min(1,"Author is required"),isbn:o.Z_8().min(1,"ISBN is required"),category:o.Z_8().min(1,"Category is required"),publishedYear:o.Rxh().min(1e3).max(new Date().getFullYear()+1),description:o.Z_8().optional().nullable(),coverImage:o.Z_8().url().optional().nullable()}),i=a.partial().extend({id:o.Z_8()}),d=o.Ryn({name:o.Z_8().min(2,"Name must be at least 2 characters"),email:o.Z_8().email("Invalid email address"),phone:o.Z_8().min(10,"Phone number must be at least 10 characters"),address:o.Z_8().min(5,"Address must be at least 5 characters"),status:o.KmV(["ACTIVE","INACTIVE"]).optional()}),u=d.partial().extend({id:o.Z_8()}),l=o.Ryn({bookId:o.Z_8(),personId:o.Z_8(),dueDate:o.Z_8().datetime()});o.Ryn({borrowingId:o.Z_8()});let p=o.Ryn({bookId:o.Z_8(),memberId:o.Z_8()});o.Ryn({memberId:o.Z_8()})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[948,972,879],()=>t(9901));module.exports=o})();