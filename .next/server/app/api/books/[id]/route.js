"use strict";(()=>{var e={};e.id=506,e.ids=[506],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9901:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>_,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>b});var t={};o.r(t),o.d(t,{DELETE:()=>m,GET:()=>u,PUT:()=>l});var n=o(9303),i=o(8716),s=o(670),a=o(7070),d=o(971);async function u(e,{params:r}){try{let e=await Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).book.findUnique({where:{id:r.id},include:{borrowings:{include:{member:!0}},reservations:{include:{member:!0}}}});if(!e)return a.NextResponse.json({error:"Book not found"},{status:404});return a.NextResponse.json(e)}catch(e){return console.error("Get book error:",e),a.NextResponse.json({error:"Failed to fetch book"},{status:500})}}async function l(e,{params:r}){try{let o=await e.json(),t={...o,id:r.id,coverImage:""===o.coverImage?null:o.coverImage,description:""===o.description?null:o.description},n=d.mC.parse(t),i=await Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).book.findUnique({where:{id:r.id}});if(!i)return a.NextResponse.json({error:"Book not found"},{status:404});if(n.isbn&&n.isbn!==i.isbn&&await Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).book.findUnique({where:{isbn:n.isbn}}))return a.NextResponse.json({error:"Book with this ISBN already exists"},{status:409});let s=await Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).book.update({where:{id:r.id},data:{...n,coverImage:n.coverImage||null,description:n.description||null},include:{borrowings:!0,reservations:!0}});return a.NextResponse.json(s)}catch(e){if(console.error("Update book error:",e),e instanceof Error&&"ZodError"===e.name)return a.NextResponse.json({error:"Invalid input data"},{status:400});return a.NextResponse.json({error:"Failed to update book"},{status:500})}}async function m(e,{params:r}){try{let e=await Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).book.findUnique({where:{id:r.id},include:{borrowings:{where:{status:"BORROWED"}},reservations:{where:{status:"WAITING"}}}});if(!e)return a.NextResponse.json({error:"Book not found"},{status:404});if(e.borrowings.length>0)return a.NextResponse.json({error:"Cannot delete book that is currently borrowed"},{status:400});if(e.reservations.length>0)return a.NextResponse.json({error:"Cannot delete book that has pending reservations"},{status:400});return await Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).book.delete({where:{id:r.id}}),a.NextResponse.json({message:"Book deleted successfully"})}catch(e){return console.error("Delete book error:",e),a.NextResponse.json({error:"Failed to delete book"},{status:500})}}!function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}();let c=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/books/[id]/route",pathname:"/api/books/[id]",filename:"route",bundlePath:"app/api/books/[id]/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\Library Project\\app\\api\\books\\[id]\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:b,serverHooks:h}=c,_="/api/books/[id]/route";function f(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:b})}},971:(e,r,o)=>{o.d(r,{AY:()=>s,Z5:()=>u,dm:()=>n,gY:()=>i,mC:()=>a,oO:()=>d});var t=o(8879);let n=t.Ryn({email:t.Z_8().min(1,"Email/Username is required"),password:t.Z_8().min(6,"Password must be at least 6 characters")}),i=t.Ryn({name:t.Z_8().min(2,"Name must be at least 2 characters"),email:t.Z_8().email("Invalid email address"),password:t.Z_8().min(6,"Password must be at least 6 characters"),role:t.KmV(["ADMIN","LIBRARIAN","MEMBER"]).optional()}),s=t.Ryn({title:t.Z_8().min(1,"Title is required"),author:t.Z_8().min(1,"Author is required"),isbn:t.Z_8().min(1,"ISBN is required"),category:t.Z_8().min(1,"Category is required"),publishedYear:t.Rxh().min(1e3).max(new Date().getFullYear()+1),description:t.Z_8().optional().nullable(),coverImage:t.Z_8().optional().nullable().refine(e=>!e||""===e||t.Z_8().url().safeParse(e).success,{message:"Cover image must be a valid URL"})}),a=s.partial().extend({id:t.Z_8()});t.Ryn({name:t.Z_8().min(2,"Name must be at least 2 characters"),email:t.Z_8().email("Invalid email address"),phone:t.Z_8().min(10,"Phone number must be at least 10 characters"),address:t.Z_8().min(5,"Address must be at least 5 characters"),status:t.KmV(["ACTIVE","INACTIVE"]).optional()}).partial().extend({id:t.Z_8()});let d=t.Ryn({bookId:t.Z_8(),personId:t.Z_8().optional(),memberId:t.Z_8().optional(),dueDate:t.Z_8().refine(e=>!isNaN(Date.parse(e)),{message:"Invalid date format"})}).refine(e=>e.personId||e.memberId,{message:"Either personId or memberId is required"});t.Ryn({borrowingId:t.Z_8()});let u=t.Ryn({bookId:t.Z_8(),personId:t.Z_8().optional(),memberId:t.Z_8().optional()}).refine(e=>e.personId||e.memberId,{message:"Either personId or memberId is required"});t.Ryn({action:t.KmV(["check-in","check-out"]),personId:t.Z_8().optional(),memberId:t.Z_8().optional(),visitorName:t.Z_8().optional(),visitorEmail:t.Z_8().optional(),visitorPhone:t.Z_8().optional()}).refine(e=>"check-in"===e.action?e.personId||e.memberId||e.visitorName&&e.visitorEmail:"check-out"!==e.action||e.personId||e.memberId||e.visitorEmail,{message:"For check-in: personId, memberId, or visitorName+visitorEmail required. For check-out: personId, memberId, or visitorEmail required"})}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[948,972,879],()=>o(9901));module.exports=t})();