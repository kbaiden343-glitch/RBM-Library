"use strict";(()=>{var e={};e.id=562,e.ids=[562],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1197:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>b});var a={};r.r(a),r.d(a,{GET:()=>u,POST:()=>m});var s=r(9303),o=r(8716),i=r(670),n=r(7070),l=r(2663),d=r(971);async function u(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),a=parseInt(t.get("limit")||"10"),s=t.get("search")||"",o=t.get("category")||"",i=t.get("status")||"",d=(r-1)*a,u={};s&&(u.OR=[{title:{contains:s,mode:"insensitive"}},{author:{contains:s,mode:"insensitive"}},{isbn:{contains:s,mode:"insensitive"}}]),o&&(u.category=o),i&&(u.status=i);let[m,c]=await Promise.all([l._.book.findMany({where:u,skip:d,take:a,orderBy:{createdAt:"desc"},include:{borrowings:{where:{status:"BORROWED"},include:{member:!0}},reservations:{where:{status:"WAITING"},include:{member:!0}}}}),l._.book.count({where:u})]);return n.NextResponse.json({books:m,pagination:{page:r,limit:a,total:c,pages:Math.ceil(c/a)}})}catch(e){return console.error("Get books error:",e),n.NextResponse.json({error:"Failed to fetch books"},{status:500})}}async function m(e){try{let t=await e.json(),r={...t,coverImage:""===t.coverImage?null:t.coverImage,description:""===t.description?null:t.description},a=d.AY.parse(r);if(await l._.book.findUnique({where:{isbn:a.isbn}}))return n.NextResponse.json({error:"Book with this ISBN already exists"},{status:409});let s=await l._.book.create({data:{...a,coverImage:a.coverImage||null,description:a.description||null},include:{borrowings:!0,reservations:!0}});return n.NextResponse.json(s,{status:201})}catch(e){if(console.error("Create book error:",e),e instanceof Error&&"ZodError"===e.name)return n.NextResponse.json({error:"Invalid input data"},{status:400});return n.NextResponse.json({error:"Failed to create book"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/books/route",pathname:"/api/books",filename:"route",bundlePath:"app/api/books/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\Library Project\\app\\api\\books\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:b,serverHooks:g}=c,h="/api/books/route";function _(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:b})}},2663:(e,t,r)=>{r.d(t,{_:()=>s});let a=require("@prisma/client"),s=globalThis.prisma??new a.PrismaClient({log:["error"]})},971:(e,t,r)=>{r.d(t,{AY:()=>i,Bs:()=>l,Z5:()=>m,dm:()=>s,gY:()=>o,lA:()=>d,mC:()=>n,oO:()=>u});var a=r(8879);let s=a.Ryn({email:a.Z_8().email("Invalid email address"),password:a.Z_8().min(6,"Password must be at least 6 characters")}),o=a.Ryn({name:a.Z_8().min(2,"Name must be at least 2 characters"),email:a.Z_8().email("Invalid email address"),password:a.Z_8().min(6,"Password must be at least 6 characters"),role:a.KmV(["ADMIN","LIBRARIAN","MEMBER"]).optional()}),i=a.Ryn({title:a.Z_8().min(1,"Title is required"),author:a.Z_8().min(1,"Author is required"),isbn:a.Z_8().min(1,"ISBN is required"),category:a.Z_8().min(1,"Category is required"),publishedYear:a.Rxh().min(1e3).max(new Date().getFullYear()+1),description:a.Z_8().optional().nullable(),coverImage:a.Z_8().url().optional().nullable()}),n=i.partial().extend({id:a.Z_8()}),l=a.Ryn({name:a.Z_8().min(2,"Name must be at least 2 characters"),email:a.Z_8().email("Invalid email address"),phone:a.Z_8().min(10,"Phone number must be at least 10 characters"),address:a.Z_8().min(5,"Address must be at least 5 characters"),status:a.KmV(["ACTIVE","INACTIVE"]).optional()}),d=l.partial().extend({id:a.Z_8()}),u=a.Ryn({bookId:a.Z_8(),memberId:a.Z_8(),dueDate:a.Z_8().datetime()});a.Ryn({borrowingId:a.Z_8()});let m=a.Ryn({bookId:a.Z_8(),memberId:a.Z_8()});a.Ryn({memberId:a.Z_8()})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,972,879],()=>r(1197));module.exports=a})();