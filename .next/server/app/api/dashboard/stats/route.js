"use strict";(()=>{var e={};e.id=41,e.ids=[41],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7974:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>b,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var r={};a.r(r),a.d(r,{GET:()=>u});var o=a(9303),s=a(8716),n=a(670),c=a(7070),i=a(2663);async function u(e){try{let{searchParams:t}=new URL(e.url),a=t.get("timeRange")||"7days",r=new Date,o=new Date;switch(a){case"7days":default:o.setDate(r.getDate()-7);break;case"30days":o.setMonth(r.getMonth()-1);break;case"90days":o.setMonth(r.getMonth()-3)}let[s,n,u,d,l,p]=await Promise.all([i._.book.count(),i._.person.count(),i._.borrowing.count({where:{status:"BORROWED"}}),i._.borrowing.count({where:{status:"BORROWED",dueDate:{lt:r}}}),i._.reservation.count({where:{status:"WAITING"}}),i._.attendance.count({where:{checkInTime:{gte:new Date(r.getFullYear(),r.getMonth(),r.getDate()),lt:new Date(r.getFullYear(),r.getMonth(),r.getDate()+1)}}})]),[g,h,b,m]=await Promise.all([i._.borrowing.count({where:{borrowDate:{gte:o}}}),i._.borrowing.count({where:{returnDate:{gte:o}}}),i._.attendance.count({where:{checkInTime:{gte:o}}}),i._.reservation.count({where:{reservationDate:{gte:o}}})]),w=(await i._.book.groupBy({by:["category"],_count:{category:!0},orderBy:{_count:{category:"desc"}},take:5})).map(e=>({name:e.category,count:e._count.category,percentage:s>0?(e._count.category/s*100).toFixed(1):"0.0"}));return c.NextResponse.json({totalBooks:s,availableBooks:s-u,totalMembers:n,activeLoans:u,overdueBooks:d,todayAttendance:p,pendingReservations:l,recentBorrowings:g,recentReturns:h,recentAttendance:b,recentReservations:m,popularCategories:w,recentActivities:[]})}catch(e){return console.error("Get dashboard stats error:",e),c.NextResponse.json({error:"Failed to fetch dashboard statistics"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/dashboard/stats/route",pathname:"/api/dashboard/stats",filename:"route",bundlePath:"app/api/dashboard/stats/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\Library Project\\app\\api\\dashboard\\stats\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:g}=d,h="/api/dashboard/stats/route";function b(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}},2663:(e,t,a)=>{let r;a.d(t,{_:()=>r});let o=require("@prisma/client"),s=globalThis,n=process.env.DATABASE_URL||process.env.POSTGRES_URL||process.env.POSTGRES_PRISMA_URL,c=n?`${n}?connection_limit=1&pool_timeout=20&connect_timeout=60&schema=public&pgbouncer=true&prepared_statements=false`:n;try{r=s.prisma??new o.PrismaClient({log:["error"],datasources:{db:{url:c}}})}catch(e){console.warn("Prisma client not available, using fallback:",e),r={}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,972],()=>a(7974));module.exports=r})();