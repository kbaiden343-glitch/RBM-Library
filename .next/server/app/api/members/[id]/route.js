"use strict";(()=>{var e={};e.id=634,e.ids=[634],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9864:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>_,patchFetch:()=>w,requestAsyncStorage:()=>b,routeModule:()=>p,serverHooks:()=>I,staticGenerationAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{DELETE:()=>c,GET:()=>l,PUT:()=>u});var i=t(9303),o=t(8716),a=t(670),n=t(7070),m=t(2663),d=t(971);async function l(e,{params:r}){try{let e=await m._.member.findUnique({where:{id:r.id},include:{borrowings:{include:{book:!0}},reservations:{include:{book:!0}},attendance:{orderBy:{checkInTime:"desc"}}}});if(!e)return n.NextResponse.json({error:"Member not found"},{status:404});return n.NextResponse.json(e)}catch(e){return console.error("Get member error:",e),n.NextResponse.json({error:"Failed to fetch member"},{status:500})}}async function u(e,{params:r}){try{let t=await e.json(),s=d.lA.parse({...t,id:r.id}),i=await m._.member.findUnique({where:{id:r.id}});if(!i)return n.NextResponse.json({error:"Member not found"},{status:404});if(s.email&&s.email!==i.email&&await m._.member.findUnique({where:{email:s.email}}))return n.NextResponse.json({error:"Member with this email already exists"},{status:409});let o=await m._.member.update({where:{id:r.id},data:s,include:{borrowings:!0,reservations:!0,attendance:!0}});return n.NextResponse.json(o)}catch(e){if(console.error("Update member error:",e),e instanceof Error&&"ZodError"===e.name)return n.NextResponse.json({error:"Invalid input data"},{status:400});return n.NextResponse.json({error:"Failed to update member"},{status:500})}}async function c(e,{params:r}){try{let e=await m._.member.findUnique({where:{id:r.id},include:{borrowings:{where:{status:"BORROWED"}},reservations:{where:{status:"WAITING"}}}});if(!e)return n.NextResponse.json({error:"Member not found"},{status:404});if(e.borrowings.length>0)return n.NextResponse.json({error:"Cannot delete member with active borrowings"},{status:400});if(e.reservations.length>0)return n.NextResponse.json({error:"Cannot delete member with pending reservations"},{status:400});return await m._.member.delete({where:{id:r.id}}),n.NextResponse.json({message:"Member deleted successfully"})}catch(e){return console.error("Delete member error:",e),n.NextResponse.json({error:"Failed to delete member"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/members/[id]/route",pathname:"/api/members/[id]",filename:"route",bundlePath:"app/api/members/[id]/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\Library Project\\app\\api\\members\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:b,staticGenerationAsyncStorage:h,serverHooks:I}=p,_="/api/members/[id]/route";function w(){return(0,a.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:h})}},2663:(e,r,t)=>{t.d(r,{_:()=>n});let s=require("@prisma/client"),i=globalThis,o=process.env.DATABASE_URL,a=o?`${o}?connection_limit=5&pool_timeout=20&connect_timeout=60`:o,n=i.prisma??new s.PrismaClient({log:["error"],datasources:{db:{url:a}}});process.on("beforeExit",async()=>{await n.$disconnect()}),process.on("SIGINT",async()=>{await n.$disconnect(),process.exit(0)}),process.on("SIGTERM",async()=>{await n.$disconnect(),process.exit(0)})},971:(e,r,t)=>{t.d(r,{AY:()=>a,Bs:()=>m,Z5:()=>u,dm:()=>i,gY:()=>o,lA:()=>d,mC:()=>n,oO:()=>l});var s=t(8879);let i=s.Ryn({email:s.Z_8().email("Invalid email address"),password:s.Z_8().min(6,"Password must be at least 6 characters")}),o=s.Ryn({name:s.Z_8().min(2,"Name must be at least 2 characters"),email:s.Z_8().email("Invalid email address"),password:s.Z_8().min(6,"Password must be at least 6 characters"),role:s.KmV(["ADMIN","LIBRARIAN","MEMBER"]).optional()}),a=s.Ryn({title:s.Z_8().min(1,"Title is required"),author:s.Z_8().min(1,"Author is required"),isbn:s.Z_8().min(1,"ISBN is required"),category:s.Z_8().min(1,"Category is required"),publishedYear:s.Rxh().min(1e3).max(new Date().getFullYear()+1),description:s.Z_8().optional().nullable(),coverImage:s.Z_8().optional().nullable().refine(e=>!e||""===e||s.Z_8().url().safeParse(e).success,{message:"Cover image must be a valid URL"})}),n=a.partial().extend({id:s.Z_8()}),m=s.Ryn({name:s.Z_8().min(2,"Name must be at least 2 characters"),email:s.Z_8().email("Invalid email address"),phone:s.Z_8().min(10,"Phone number must be at least 10 characters"),address:s.Z_8().min(5,"Address must be at least 5 characters"),status:s.KmV(["ACTIVE","INACTIVE"]).optional()}),d=m.partial().extend({id:s.Z_8()}),l=s.Ryn({bookId:s.Z_8(),personId:s.Z_8().optional(),memberId:s.Z_8().optional(),dueDate:s.Z_8().refine(e=>!isNaN(Date.parse(e)),{message:"Invalid date format"})}).refine(e=>e.personId||e.memberId,{message:"Either personId or memberId is required"});s.Ryn({borrowingId:s.Z_8()});let u=s.Ryn({bookId:s.Z_8(),personId:s.Z_8().optional(),memberId:s.Z_8().optional()}).refine(e=>e.personId||e.memberId,{message:"Either personId or memberId is required"});s.Ryn({action:s.KmV(["check-in","check-out"]),personId:s.Z_8().optional(),memberId:s.Z_8().optional(),visitorName:s.Z_8().optional(),visitorEmail:s.Z_8().optional(),visitorPhone:s.Z_8().optional()}).refine(e=>"check-in"===e.action?e.personId||e.memberId||e.visitorName&&e.visitorEmail:"check-out"!==e.action||e.personId||e.memberId||e.visitorEmail,{message:"For check-in: personId, memberId, or visitorName+visitorEmail required. For check-out: personId, memberId, or visitorEmail required"})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,879],()=>t(9864));module.exports=s})();