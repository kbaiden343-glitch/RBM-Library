"use strict";(()=>{var e={};e.id=79,e.ids=[79],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1760:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>O,patchFetch:()=>h,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>l});var o={};r.r(o),r.d(o,{GET:()=>d});var n=r(9303),a=r(8716),s=r(670),i=r(7070);async function d(e){try{let{searchParams:t}=new URL(e.url),r=t.get("startDate"),o=t.get("endDate"),n={};r&&o&&(n.createdAt={gte:new Date(r),lte:new Date(o)});let[a,s,d,u,c,l,p,O,h,D]=await Promise.all([Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:n}),Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:{...n,personType:"MEMBER"}}),Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:{...n,personType:"VISITOR"}}),Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:{...n,status:"ACTIVE"}}),Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:{...n,status:"INACTIVE"}}),Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:{...n,status:"BANNED"}}),Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:{...n,status:"SUSPENDED"}}),Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:{createdAt:{gte:new Date(Date.now()-2592e6)}}}),Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:{createdAt:{gte:new Date(Date.now()-6048e5)}}}),Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:{createdAt:{gte:new Date(Date.now()-2592e6)}}})]),w=await Promise.all(Array.from({length:7},(e,t)=>{let r=new Date;r.setDate(r.getDate()-t);let o=new Date(r.setHours(0,0,0,0)),n=new Date(r.setHours(23,59,59,999));return Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:{createdAt:{gte:o,lte:n}}}).then(e=>({date:o.toISOString().split("T")[0],count:e}))})),b=await Promise.all(Array.from({length:12},(e,t)=>{let r=new Date;r.setMonth(r.getMonth()-t);let o=new Date(r.getFullYear(),r.getMonth(),1),n=new Date(r.getFullYear(),r.getMonth()+1,0);return Object(function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).person.count({where:{createdAt:{gte:o,lte:n}}}).then(e=>({month:o.toISOString().substring(0,7),count:e}))})),E=d>0?s/(s+d)*100:0,f=a>0?u/a*100:0,m=a>0?O/a*100:0,N=O/30;return i.NextResponse.json({overview:{totalPeople:a,totalMembers:s,totalVisitors:d,activePeople:u,inactivePeople:c,bannedPeople:l,suspendedPeople:p,recentPeople:O,weeklyPeople:h,monthlyPeople:D},insights:{memberConversionRate:Math.round(10*E)/10,activeRate:Math.round(10*f)/10,growthRate:Math.round(10*m)/10,averageDailyRegistrations:Math.round(10*N)/10},trends:{daily:w.reverse(),monthly:b.reverse()}})}catch(e){return console.error("Get person stats error:",e),i.NextResponse.json({error:"Failed to fetch person statistics"},{status:500})}}!function(){var e=Error("Cannot find module '../../../lib/db'");throw e.code="MODULE_NOT_FOUND",e}();let u=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/persons/stats/route",pathname:"/api/persons/stats",filename:"route",bundlePath:"app/api/persons/stats/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\Library Project\\app\\api\\persons\\stats\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:p}=u,O="/api/persons/stats/route";function h(){return(0,s.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:l})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,972],()=>r(1760));module.exports=o})();