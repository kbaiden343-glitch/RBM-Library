"use strict";(()=>{var e={};e.id=79,e.ids=[79],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1760:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>d,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{GET:()=>p});var s=r(9303),o=r(8716),a=r(670),i=r(7070),u=r(2663);async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("startDate"),n=t.get("endDate"),s={};r&&n&&(s.createdAt={gte:new Date(r),lte:new Date(n)});let[o,a,p,l,c,h,d,w,g,m]=await Promise.all([u._.person.count({where:s}),u._.person.count({where:{...s,personType:"MEMBER"}}),u._.person.count({where:{...s,personType:"VISITOR"}}),u._.person.count({where:{...s,status:"ACTIVE"}}),u._.person.count({where:{...s,status:"INACTIVE"}}),u._.person.count({where:{...s,status:"BANNED"}}),u._.person.count({where:{...s,status:"SUSPENDED"}}),u._.person.count({where:{createdAt:{gte:new Date(Date.now()-2592e6)}}}),u._.person.count({where:{createdAt:{gte:new Date(Date.now()-6048e5)}}}),u._.person.count({where:{createdAt:{gte:new Date(Date.now()-2592e6)}}})]),D=await Promise.all(Array.from({length:7},(e,t)=>{let r=new Date;r.setDate(r.getDate()-t);let n=new Date(r.setHours(0,0,0,0)),s=new Date(r.setHours(23,59,59,999));return u._.person.count({where:{createdAt:{gte:n,lte:s}}}).then(e=>({date:n.toISOString().split("T")[0],count:e}))})),_=await Promise.all(Array.from({length:12},(e,t)=>{let r=new Date;r.setMonth(r.getMonth()-t);let n=new Date(r.getFullYear(),r.getMonth(),1),s=new Date(r.getFullYear(),r.getMonth()+1,0);return u._.person.count({where:{createdAt:{gte:n,lte:s}}}).then(e=>({month:n.toISOString().substring(0,7),count:e}))})),v=p>0?a/(a+p)*100:0,A=o>0?l/o*100:0,R=o>0?w/o*100:0,P=w/30;return i.NextResponse.json({overview:{totalPeople:o,totalMembers:a,totalVisitors:p,activePeople:l,inactivePeople:c,bannedPeople:h,suspendedPeople:d,recentPeople:w,weeklyPeople:g,monthlyPeople:m},insights:{memberConversionRate:Math.round(10*v)/10,activeRate:Math.round(10*A)/10,growthRate:Math.round(10*R)/10,averageDailyRegistrations:Math.round(10*P)/10},trends:{daily:D.reverse(),monthly:_.reverse()}})}catch(e){return console.error("Get person stats error:",e),i.NextResponse.json({error:"Failed to fetch person statistics"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/persons/stats/route",pathname:"/api/persons/stats",filename:"route",bundlePath:"app/api/persons/stats/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\Library Project\\app\\api\\persons\\stats\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:c,staticGenerationAsyncStorage:h,serverHooks:d}=l,w="/api/persons/stats/route";function g(){return(0,a.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:h})}},2663:(e,t,r)=>{let n;r.d(t,{_:()=>n});let s=require("@prisma/client"),o=globalThis,a=process.env.DATABASE_URL||process.env.POSTGRES_URL||process.env.POSTGRES_PRISMA_URL,i=a?`${a}?connection_limit=1&pool_timeout=20&connect_timeout=60&schema=public&pgbouncer=true&prepared_statements=false`:a;try{n=o.prisma??new s.PrismaClient({log:["error"],datasources:{db:{url:i}}})}catch(e){console.warn("Prisma client not available, using fallback:",e),n={}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(1760));module.exports=n})();