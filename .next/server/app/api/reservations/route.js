"use strict";(()=>{var e={};e.id=984,e.ids=[984],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},560:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>_,patchFetch:()=>h,requestAsyncStorage:()=>c,routeModule:()=>m,serverHooks:()=>b,staticGenerationAsyncStorage:()=>I});var o={};t.r(o),t.d(o,{GET:()=>p,POST:()=>l});var s=t(9303),a=t(8716),n=t(670),i=t(7070),d=t(2663),u=t(971);async function p(e){try{let{searchParams:r}=new URL(e.url),t=parseInt(r.get("page")||"1"),o=parseInt(r.get("limit")||"10"),s=r.get("status")||"",a=r.get("personId")||"",n=r.get("bookId")||"",u=(t-1)*o,p={};s&&(p.status=s),a&&(p.personId=a),n&&(p.bookId=n);let[l,m]=await Promise.all([d._.reservation.findMany({where:p,skip:u,take:o,orderBy:{createdAt:"desc"},include:{book:!0,person:!0}}),d._.reservation.count({where:p})]);return i.NextResponse.json({reservations:l,pagination:{page:t,limit:o,total:m,pages:Math.ceil(m/o)}})}catch(e){return console.error("Get reservations error:",e),i.NextResponse.json({error:"Failed to fetch reservations"},{status:500})}}async function l(e){try{let r=await e.json(),t=u.Z5.parse(r),o=await d._.book.findUnique({where:{id:t.bookId}});if(!o)return i.NextResponse.json({error:"Book not found"},{status:404});if(!t.personId)return i.NextResponse.json({error:"Person ID is required"},{status:400});let s=await d._.person.findUnique({where:{id:t.personId}});if(!s)return i.NextResponse.json({error:"Person not found"},{status:404});if("ACTIVE"!==s.status)return i.NextResponse.json({error:"Person is not active"},{status:400});if(await d._.reservation.findFirst({where:{bookId:t.bookId,personId:t.personId,status:"WAITING"}}))return i.NextResponse.json({error:"Person already has a reservation for this book"},{status:409});if(await d._.borrowing.findFirst({where:{bookId:t.bookId,personId:t.personId,status:"BORROWED"}}))return i.NextResponse.json({error:"Person already has this book borrowed"},{status:409});let a=await d._.reservation.create({data:{bookId:t.bookId,personId:t.personId},include:{book:!0,person:!0}});return"AVAILABLE"===o.status&&await d._.book.update({where:{id:t.bookId},data:{status:"RESERVED"}}),i.NextResponse.json(a,{status:201})}catch(e){if(console.error("Create reservation error:",e),e instanceof Error&&"ZodError"===e.name)return i.NextResponse.json({error:"Invalid input data"},{status:400});return i.NextResponse.json({error:"Failed to create reservation"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/reservations/route",pathname:"/api/reservations",filename:"route",bundlePath:"app/api/reservations/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\Library Project\\app\\api\\reservations\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:I,serverHooks:b}=m,_="/api/reservations/route";function h(){return(0,n.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:I})}},2663:(e,r,t)=>{let o;t.d(r,{_:()=>o});let s=require("@prisma/client"),a=globalThis,n=process.env.DATABASE_URL||process.env.POSTGRES_URL||process.env.POSTGRES_PRISMA_URL,i=n?`${n}?connection_limit=1&pool_timeout=20&connect_timeout=60&schema=public&pgbouncer=true&prepared_statements=false`:n;try{o=a.prisma??new s.PrismaClient({log:["error"],datasources:{db:{url:i}}})}catch(e){console.warn("Prisma client not available, using fallback:",e),o={}}},971:(e,r,t)=>{t.d(r,{AY:()=>n,Z5:()=>u,dm:()=>s,gY:()=>a,mC:()=>i,oO:()=>d});var o=t(8879);let s=o.Ryn({email:o.Z_8().min(1,"Email/Username is required"),password:o.Z_8().min(6,"Password must be at least 6 characters")}),a=o.Ryn({name:o.Z_8().min(2,"Name must be at least 2 characters"),email:o.Z_8().email("Invalid email address"),password:o.Z_8().min(6,"Password must be at least 6 characters"),role:o.KmV(["ADMIN","LIBRARIAN","MEMBER"]).optional()}),n=o.Ryn({title:o.Z_8().min(1,"Title is required"),author:o.Z_8().min(1,"Author is required"),isbn:o.Z_8().min(1,"ISBN is required"),category:o.Z_8().min(1,"Category is required"),publishedYear:o.Rxh().min(1e3).max(new Date().getFullYear()+1),description:o.Z_8().optional().nullable(),coverImage:o.Z_8().optional().nullable().refine(e=>!e||""===e||o.Z_8().url().safeParse(e).success,{message:"Cover image must be a valid URL"})}),i=n.partial().extend({id:o.Z_8()});o.Ryn({name:o.Z_8().min(2,"Name must be at least 2 characters"),email:o.Z_8().email("Invalid email address"),phone:o.Z_8().min(10,"Phone number must be at least 10 characters"),address:o.Z_8().min(5,"Address must be at least 5 characters"),status:o.KmV(["ACTIVE","INACTIVE"]).optional()}).partial().extend({id:o.Z_8()});let d=o.Ryn({bookId:o.Z_8(),personId:o.Z_8().optional(),memberId:o.Z_8().optional(),dueDate:o.Z_8().refine(e=>!isNaN(Date.parse(e)),{message:"Invalid date format"})}).refine(e=>e.personId||e.memberId,{message:"Either personId or memberId is required"});o.Ryn({borrowingId:o.Z_8()});let u=o.Ryn({bookId:o.Z_8(),personId:o.Z_8().optional(),memberId:o.Z_8().optional()}).refine(e=>e.personId||e.memberId,{message:"Either personId or memberId is required"});o.Ryn({action:o.KmV(["check-in","check-out"]),personId:o.Z_8().optional(),memberId:o.Z_8().optional(),visitorName:o.Z_8().optional(),visitorEmail:o.Z_8().optional(),visitorPhone:o.Z_8().optional()}).refine(e=>"check-in"===e.action?e.personId||e.memberId||e.visitorName&&e.visitorEmail:"check-out"!==e.action||e.personId||e.memberId||e.visitorEmail,{message:"For check-in: personId, memberId, or visitorName+visitorEmail required. For check-out: personId, memberId, or visitorEmail required"})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[948,972,879],()=>t(560));module.exports=o})();