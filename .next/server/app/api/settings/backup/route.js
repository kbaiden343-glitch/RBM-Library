"use strict";(()=>{var e={};e.id=69,e.ids=[69],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4346:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>g,patchFetch:()=>m,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>b,staticGenerationAsyncStorage:()=>d});var r={};n.r(r),n.d(r,{POST:()=>u});var a=n(9303),i=n(8716),o=n(670),s=n(7070),p=n(2663);async function u(e){try{let{type:t}=await e.json();if("export"===t){let[e,t,n,r,a,i]=await Promise.all([p._.book.findMany({include:{borrowings:!0,reservations:!0}}),p._.person.findMany({include:{borrowings:!0,reservations:!0,attendance:!0}}),p._.borrowing.findMany({include:{book:!0,person:!0}}),p._.reservation.findMany({include:{book:!0,person:!0}}),p._.attendance.findMany({include:{person:!0}}),p._.settings.findFirst()]),o={exportDate:new Date().toISOString(),version:"1.0",libraryName:i?.libraryName||"Library",data:{books:e,persons:t,borrowings:n,reservations:r,attendance:a,settings:i}},u=new Date().toISOString().split("T")[0],c=`library-export-${u}.json`;return new s.NextResponse(JSON.stringify(o,null,2),{status:200,headers:{"Content-Type":"application/json","Content-Disposition":`attachment; filename="${c}"`}})}if("backup"!==t)return s.NextResponse.json({error:'Invalid backup type. Use "export" or "backup"'},{status:400});{let[e,t,n,r,a,i]=await Promise.all([p._.book.findMany({include:{borrowings:!0,reservations:!0}}),p._.person.findMany({include:{borrowings:!0,reservations:!0,attendance:!0}}),p._.borrowing.findMany({include:{book:!0,person:!0}}),p._.reservation.findMany({include:{book:!0,person:!0}}),p._.attendance.findMany({include:{person:!0}}),p._.settings.findFirst()]),o={backupDate:new Date().toISOString(),version:"1.0",libraryName:i?.libraryName||"Library",data:{books:e,persons:t,borrowings:n,reservations:r,attendance:a,settings:i}},u=new Date().toISOString().replace(/[:.]/g,"-"),c=`library-backup-${u}.json`;return new s.NextResponse(JSON.stringify(o,null,2),{status:200,headers:{"Content-Type":"application/json","Content-Disposition":`attachment; filename="${c}"`}})}}catch(e){return console.error("Error creating backup/export:",e),s.NextResponse.json({error:"Failed to create backup/export"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/settings/backup/route",pathname:"/api/settings/backup",filename:"route",bundlePath:"app/api/settings/backup/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\Library Project\\app\\api\\settings\\backup\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:b}=c,g="/api/settings/backup/route";function m(){return(0,o.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:d})}},2663:(e,t,n)=>{let r;n.d(t,{_:()=>r});let a=require("@prisma/client"),i=globalThis,o=process.env.DATABASE_URL||process.env.POSTGRES_URL||process.env.POSTGRES_PRISMA_URL,s=o?`${o}?connection_limit=1&pool_timeout=20&connect_timeout=60&schema=public&pgbouncer=true&prepared_statements=false`:o;try{r=i.prisma??new a.PrismaClient({log:["error"],datasources:{db:{url:s}}})}catch(e){console.warn("Prisma client not available, using fallback:",e),r={}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[948,972],()=>n(4346));module.exports=r})();