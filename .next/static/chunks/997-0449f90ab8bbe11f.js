"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[997],{6501:function(e,a,r){r.d(a,{AuthProvider:function(){return u},a:function(){return y}});var t=r(7437),o=r(2265),s=r(9064),n=r(8626);let l=(0,o.createContext)(null),i={user:null,isAuthenticated:!1,loading:!1,error:null},d=(e,a)=>{switch(a.type){case"LOGIN_START":return{...e,loading:!0,error:null};case"LOGIN_SUCCESS":return{...e,user:a.payload,isAuthenticated:!0,loading:!1,error:null};case"LOGIN_FAILURE":return{...e,user:null,isAuthenticated:!1,loading:!1,error:a.payload};case"LOGOUT":return{...e,user:null,isAuthenticated:!1,loading:!1,error:null};case"CLEAR_ERROR":return{...e,error:null};case"SET_LOADING":return{...e,loading:a.payload};default:return e}},c=e=>{switch(e){case"ADMIN":return["all"];case"LIBRARIAN":return["books:read","books:create","books:update","books:delete","members:read","members:create","members:update","members:delete","borrowing:read","borrowing:create","borrowing:update","reservations:read","reservations:create","reservations:update","attendance:read","attendance:create","manage_attendance","reports:read","dashboard:read","settings:read"];case"MEMBER":return["books:read","borrowing:read","reservations:read","reservations:create","attendance:create"];default:return[]}},u=e=>{let{children:a}=e,[r,u]=(0,o.useReducer)(d,i);(0,o.useEffect)(()=>{let e=localStorage.getItem("library_user"),a=localStorage.getItem("token");if(e&&a)try{let a=JSON.parse(e);a.id&&a.email&&a.role?u({type:"LOGIN_SUCCESS",payload:a}):(localStorage.removeItem("library_user"),localStorage.removeItem("token"))}catch(e){console.error("Error parsing saved user:",e),localStorage.removeItem("library_user"),localStorage.removeItem("token")}},[]);let y=async(e,a)=>{u({type:"LOGIN_START"});try{let r=await n.Z.post("/api/auth/login",{email:e,password:a});if(r.error)u({type:"LOGIN_FAILURE",payload:r.error}),s.default.error(r.error);else{let e={...r.data.user,permissions:c(r.data.user.role)};u({type:"LOGIN_SUCCESS",payload:e}),localStorage.setItem("library_user",JSON.stringify(e)),localStorage.setItem("token",r.data.token),s.default.success("Welcome back, ".concat(e.name,"!"))}}catch(e){u({type:"LOGIN_FAILURE",payload:"Login failed. Please try again."}),s.default.error("Login failed. Please try again.")}},p=async function(e,a,r){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"MEMBER";u({type:"LOGIN_START"});try{let o=await n.Z.post("/api/auth/register",{name:e,email:a,password:r,role:t});if(o.error)u({type:"LOGIN_FAILURE",payload:o.error}),s.default.error(o.error);else{let e={...o.data.user,permissions:c(o.data.user.role)};u({type:"LOGIN_SUCCESS",payload:e}),localStorage.setItem("library_user",JSON.stringify(e)),localStorage.setItem("token",o.data.token),s.default.success("Welcome, ".concat(e.name,"!"))}}catch(e){u({type:"LOGIN_FAILURE",payload:"Registration failed. Please try again."}),s.default.error("Registration failed. Please try again.")}};return(0,t.jsx)(l.Provider,{value:{state:r,login:y,register:p,logout:()=>{u({type:"LOGOUT"}),localStorage.removeItem("library_user"),localStorage.removeItem("token"),s.default.success("Logged out successfully")},clearError:()=>{u({type:"CLEAR_ERROR"})},hasPermission:e=>!!r.user&&(!!r.user.permissions.includes("all")||r.user.permissions.includes(e))},children:a})},y=()=>{let e=(0,o.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},700:function(e,a,r){r.d(a,{LibraryProvider:function(){return c},y:function(){return u}});var t=r(7437),o=r(2265),s=r(9064);let n=(0,o.createContext)(null),l={books:[],members:[],borrowings:[],reservations:[],attendance:[],currentUser:null,loading:!1,error:null},i=(e,a)=>{switch(a.type){case"SET_LOADING":return{...e,loading:a.payload};case"SET_ERROR":return{...e,error:a.payload};case"SET_BOOKS":return{...e,books:a.payload};case"ADD_BOOK":return{...e,books:[...e.books,a.payload]};case"UPDATE_BOOK":return{...e,books:e.books.map(e=>e.id===a.payload.id?a.payload:e)};case"DELETE_BOOK":return{...e,books:e.books.filter(e=>e.id!==a.payload)};case"SET_MEMBERS":return{...e,members:a.payload};case"ADD_MEMBER":return{...e,members:[...e.members,a.payload]};case"UPDATE_MEMBER":return{...e,members:e.members.map(e=>e.id===a.payload.id?a.payload:e)};case"DELETE_MEMBER":return{...e,members:e.members.filter(e=>e.id!==a.payload)};case"SET_BORROWINGS":return{...e,borrowings:a.payload};case"ADD_BORROWING":return{...e,borrowings:[...e.borrowings,a.payload]};case"RETURN_BOOK":return{...e,borrowings:e.borrowings.map(e=>e.id===a.payload.id?a.payload:e)};case"SET_RESERVATIONS":return{...e,reservations:a.payload};case"ADD_RESERVATION":return{...e,reservations:[...e.reservations,a.payload]};case"SET_ATTENDANCE":return{...e,attendance:a.payload};case"ADD_ATTENDANCE":return{...e,attendance:[...e.attendance,a.payload]};case"SET_CURRENT_USER":return{...e,currentUser:a.payload};default:return e}},d=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=localStorage.getItem("token"),t=await fetch(e,{...a,headers:{"Content-Type":"application/json",...r&&{Authorization:"Bearer ".concat(r)},...a.headers}});if(!t.ok){let e=await t.json();throw console.error("API Error:",e),Error(e.error||"API call failed")}return t.json()},c=e=>{let{children:a}=e,[r,c]=(0,o.useReducer)(i,l),u=async()=>{try{c({type:"SET_LOADING",payload:!0});let e=await d("/api/books");c({type:"SET_BOOKS",payload:e.books||e})}catch(e){console.error("Error fetching books:",e),c({type:"SET_ERROR",payload:"Failed to fetch books"}),s.default.error("Failed to fetch books")}finally{c({type:"SET_LOADING",payload:!1})}},y=async()=>{try{var e;c({type:"SET_LOADING",payload:!0});let a=await d("/api/persons?limit=100"),r=(null===(e=a.persons)||void 0===e?void 0:e.map(e=>({id:e.id,name:e.name,email:e.email,phone:e.phone||"",address:e.address||"",membershipDate:e.membershipDate||e.createdAt,status:"ACTIVE"===e.status?"ACTIVE":"INACTIVE",personType:e.personType,createdAt:e.createdAt,updatedAt:e.updatedAt})))||[];c({type:"SET_MEMBERS",payload:r})}catch(e){console.error("Error fetching members:",e),c({type:"SET_ERROR",payload:"Failed to fetch members"}),s.default.error("Failed to fetch members")}finally{c({type:"SET_LOADING",payload:!1})}},p=async()=>{try{c({type:"SET_LOADING",payload:!0});let e=await d("/api/borrowings");c({type:"SET_BORROWINGS",payload:e.borrowings||e})}catch(e){console.error("Error fetching borrowings:",e),c({type:"SET_ERROR",payload:"Failed to fetch borrowings"}),s.default.error("Failed to fetch borrowings")}finally{c({type:"SET_LOADING",payload:!1})}},E=async()=>{try{c({type:"SET_LOADING",payload:!0});let e=await d("/api/reservations");c({type:"SET_RESERVATIONS",payload:e.reservations||e})}catch(e){console.error("Error fetching reservations:",e),c({type:"SET_ERROR",payload:"Failed to fetch reservations"}),s.default.error("Failed to fetch reservations")}finally{c({type:"SET_LOADING",payload:!1})}},m=async()=>{try{c({type:"SET_LOADING",payload:!0});let e=await d("/api/attendance");c({type:"SET_ATTENDANCE",payload:e.attendance||e})}catch(e){console.error("Error fetching attendance:",e),c({type:"SET_ERROR",payload:"Failed to fetch attendance"}),s.default.error("Failed to fetch attendance")}finally{c({type:"SET_LOADING",payload:!1})}};return(0,t.jsx)(n.Provider,{value:{state:r,dispatch:c,addBook:async e=>{try{c({type:"SET_LOADING",payload:!0}),console.log("Adding book with data:",e);let a=await d("/api/books",{method:"POST",body:JSON.stringify(e)});c({type:"ADD_BOOK",payload:a}),s.default.success("Book added successfully!")}catch(e){var a,r;if(console.error("Error adding book:",e),!(null===(a=e.message)||void 0===a?void 0:a.includes("already exists"))&&!(null===(r=e.message)||void 0===r?void 0:r.includes("already exists"))){let a=e.message||"Failed to add book";s.default.error(a)}throw e}finally{c({type:"SET_LOADING",payload:!1})}},updateBook:async e=>{try{c({type:"SET_LOADING",payload:!0});let a=await d("/api/books/".concat(e.id),{method:"PUT",body:JSON.stringify(e)});c({type:"UPDATE_BOOK",payload:a}),s.default.success("Book updated successfully!")}catch(e){console.error("Error updating book:",e),s.default.error("Failed to update book")}finally{c({type:"SET_LOADING",payload:!1})}},deleteBook:async e=>{try{c({type:"SET_LOADING",payload:!0}),await d("/api/books/".concat(e),{method:"DELETE"}),c({type:"DELETE_BOOK",payload:e}),s.default.success("Book deleted successfully!")}catch(e){console.error("Error deleting book:",e),s.default.error("Failed to delete book")}finally{c({type:"SET_LOADING",payload:!1})}},addMember:async e=>{try{c({type:"SET_LOADING",payload:!0});let a={name:e.name,email:e.email,phone:e.phone,address:e.address,personType:e.personType||"MEMBER",status:e.status||"ACTIVE"},r=await d("/api/persons",{method:"POST",body:JSON.stringify(a)});c({type:"ADD_MEMBER",payload:r}),s.default.success("Member added successfully!")}catch(e){var a,r;throw console.error("Error adding member:",e),(null===(a=e.message)||void 0===a?void 0:a.includes("already exists"))||(null===(r=e.message)||void 0===r?void 0:r.includes("already exists"))||s.default.error("Failed to add member"),e}finally{c({type:"SET_LOADING",payload:!1})}},updateMember:async e=>{try{c({type:"SET_LOADING",payload:!0});let a={name:e.name,email:e.email,phone:e.phone,address:e.address,personType:e.personType,status:e.status,notes:e.notes,emergencyContact:e.emergencyContact},r=await d("/api/persons/".concat(e.id),{method:"PUT",body:JSON.stringify(a)});c({type:"UPDATE_MEMBER",payload:r}),s.default.success("Member updated successfully!")}catch(e){console.error("Error updating member:",e),s.default.error("Failed to update member")}finally{c({type:"SET_LOADING",payload:!1})}},deleteMember:async e=>{try{c({type:"SET_LOADING",payload:!0}),await d("/api/persons/".concat(e),{method:"DELETE"}),c({type:"DELETE_MEMBER",payload:e}),s.default.success("Member deleted successfully!")}catch(e){console.error("Error deleting member:",e),s.default.error("Failed to delete member")}finally{c({type:"SET_LOADING",payload:!1})}},borrowBook:async e=>{try{c({type:"SET_LOADING",payload:!0});let a=await d("/api/borrowings",{method:"POST",body:JSON.stringify(e)});c({type:"ADD_BORROWING",payload:a}),s.default.success("Book borrowed successfully!")}catch(e){var a,r;throw console.error("Error borrowing book:",e),(null===(a=e.message)||void 0===a?void 0:a.includes("already"))||(null===(r=e.message)||void 0===r?void 0:r.includes("not found"))||s.default.error("Failed to borrow book"),e}finally{c({type:"SET_LOADING",payload:!1})}},returnBook:async e=>{try{c({type:"SET_LOADING",payload:!0});let a=await d("/api/borrowings/".concat(e),{method:"PUT",body:JSON.stringify({action:"return"})});c({type:"RETURN_BOOK",payload:a}),s.default.success("Book returned successfully!")}catch(e){console.error("Error returning book:",e),s.default.error("Failed to return book")}finally{c({type:"SET_LOADING",payload:!1})}},addReservation:async e=>{try{c({type:"SET_LOADING",payload:!0});let a=await d("/api/reservations",{method:"POST",body:JSON.stringify(e)});c({type:"ADD_RESERVATION",payload:a}),s.default.success("Book reserved successfully!")}catch(e){var a,r;throw console.error("Error adding reservation:",e),(null===(a=e.message)||void 0===a?void 0:a.includes("already"))||(null===(r=e.message)||void 0===r?void 0:r.includes("not found"))||s.default.error("Failed to reserve book"),e}finally{c({type:"SET_LOADING",payload:!1})}},addAttendance:async e=>{try{c({type:"SET_LOADING",payload:!0});let a={action:"check-in",personId:e.personId,memberId:e.memberId,visitorName:e.visitorName,visitorEmail:e.visitorEmail,visitorPhone:e.visitorPhone},r=await d("/api/attendance",{method:"POST",body:JSON.stringify(a)});c({type:"ADD_ATTENDANCE",payload:r}),s.default.success("Attendance recorded successfully!")}catch(e){var a,r;throw console.error("Error adding attendance:",e),(null===(a=e.message)||void 0===a?void 0:a.includes("already"))||(null===(r=e.message)||void 0===r?void 0:r.includes("already checked in"))||s.default.error("Failed to record attendance"),e}finally{c({type:"SET_LOADING",payload:!1})}},getRecommendations:e=>{let a=r.borrowings.filter(a=>a.memberId===e).map(e=>r.books.find(a=>a.id===e.bookId)).filter(Boolean),t=a.map(e=>e.category),o=t.sort((e,a)=>t.filter(a=>a===e).length-t.filter(e=>e===a).length).pop();return r.books.filter(e=>e.category===o&&!a.some(a=>a.id===e.id)&&"AVAILABLE"===e.status).slice(0,3)},fetchBooks:u,fetchMembers:y,fetchBorrowings:p,fetchReservations:E,fetchAttendance:m},children:a})},u=()=>{let e=(0,o.useContext)(n);if(!e)throw Error("useLibrary must be used within a LibraryProvider");return e}},9124:function(e,a,r){r.d(a,{NotificationProvider:function(){return d},z:function(){return c}});var t=r(7437),o=r(2265),s=r(9064);let n=(0,o.createContext)(null),l={notifications:[],unreadCount:0},i=(e,a)=>{switch(a.type){case"ADD_NOTIFICATION":let r={...a.payload,id:Date.now().toString(),timestamp:new Date,read:!1};return{...e,notifications:[r,...e.notifications],unreadCount:e.unreadCount+1};case"MARK_AS_READ":return{...e,notifications:e.notifications.map(e=>e.id===a.payload?{...e,read:!0}:e),unreadCount:Math.max(0,e.unreadCount-1)};case"MARK_ALL_AS_READ":return{...e,notifications:e.notifications.map(e=>({...e,read:!0})),unreadCount:0};case"REMOVE_NOTIFICATION":let t=e.notifications.find(e=>e.id===a.payload);return{...e,notifications:e.notifications.filter(e=>e.id!==a.payload),unreadCount:t&&!t.read?Math.max(0,e.unreadCount-1):e.unreadCount};case"CLEAR_ALL_NOTIFICATIONS":return{...e,notifications:[],unreadCount:0};default:return e}},d=e=>{let{children:a}=e,[r,d]=(0,o.useReducer)(i,l);return(0,o.useEffect)(()=>{let e=localStorage.getItem("library_notifications");if(e)try{JSON.parse(e).forEach(e=>{d({type:"ADD_NOTIFICATION",payload:e})})}catch(e){localStorage.removeItem("library_notifications")}},[]),(0,o.useEffect)(()=>{localStorage.setItem("library_notifications",JSON.stringify(r.notifications))},[r.notifications]),(0,t.jsx)(n.Provider,{value:{state:r,addNotification:e=>{switch(d({type:"ADD_NOTIFICATION",payload:e}),e.type){case"success":s.default.success(e.message);break;case"error":s.default.error(e.message);break;case"warning":(0,s.default)(e.message,{icon:"⚠️"});break;default:(0,s.default)(e.message)}},markAsRead:e=>{d({type:"MARK_AS_READ",payload:e})},markAllAsRead:()=>{d({type:"MARK_ALL_AS_READ"})},removeNotification:e=>{d({type:"REMOVE_NOTIFICATION",payload:e})},clearAllNotifications:()=>{d({type:"CLEAR_ALL_NOTIFICATIONS"})}},children:a})},c=()=>{let e=(0,o.useContext)(n);if(!e)throw Error("useNotifications must be used within a NotificationProvider");return e}},8626:function(e,a,r){class t{async makeRequest(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=localStorage.getItem("token"),t={...a,headers:{"Content-Type":"application/json",...r&&{Authorization:"Bearer ".concat(r)},...a.headers}};try{let a=await fetch("".concat(this.baseURL).concat(e),t);if(401===a.status)return this.handleUnauthorized(),{error:"Session expired. Please log in again.",status:401};let r=await a.json();if(!a.ok)return{error:r.error||"Request failed with status ".concat(a.status),status:a.status};return{data:r,status:a.status}}catch(e){return console.error("API request failed:",e),{error:"Network error. Please check your connection.",status:0}}}handleUnauthorized(){localStorage.removeItem("token"),localStorage.removeItem("library_user"),Promise.resolve().then(r.bind(r,9064)).then(e=>{let{default:a}=e;a.error("Session expired. Please log in again.")}),window.location.href="/"}async get(e){return this.makeRequest(e,{method:"GET"})}async post(e,a){return this.makeRequest(e,{method:"POST",body:a?JSON.stringify(a):void 0})}async put(e,a){return this.makeRequest(e,{method:"PUT",body:a?JSON.stringify(a):void 0})}async delete(e){return this.makeRequest(e,{method:"DELETE"})}isAuthenticated(){let e=localStorage.getItem("token"),a=localStorage.getItem("library_user");return!!(e&&a)}getCurrentUser(){try{let e=localStorage.getItem("library_user");return e?JSON.parse(e):null}catch(e){return null}}constructor(){this.baseURL=""}}let o=new t;a.Z=o}}]);