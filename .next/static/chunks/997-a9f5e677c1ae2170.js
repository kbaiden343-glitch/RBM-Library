"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[997],{6501:function(e,a,r){r.d(a,{AuthProvider:function(){return c},a:function(){return y}});var t=r(7437),o=r(2265),s=r(9064);let n=(0,o.createContext)(null),i={user:null,isAuthenticated:!1,loading:!1,error:null},l=(e,a)=>{switch(a.type){case"LOGIN_START":return{...e,loading:!0,error:null};case"LOGIN_SUCCESS":return{...e,user:a.payload,isAuthenticated:!0,loading:!1,error:null};case"LOGIN_FAILURE":return{...e,user:null,isAuthenticated:!1,loading:!1,error:a.payload};case"LOGOUT":return{...e,user:null,isAuthenticated:!1,loading:!1,error:null};case"CLEAR_ERROR":return{...e,error:null};case"SET_LOADING":return{...e,loading:a.payload};default:return e}},d=e=>{switch(e){case"ADMIN":return["all"];case"LIBRARIAN":return["books:read","books:create","books:update","books:delete","members:read","members:create","members:update","members:delete","borrowing:read","borrowing:create","borrowing:update","reservations:read","reservations:create","reservations:update","attendance:read","attendance:create","manage_attendance","reports:read","dashboard:read","settings:read"];case"MEMBER":return["books:read","borrowing:read","reservations:read","reservations:create","attendance:create"];default:return[]}},c=e=>{let{children:a}=e,[r,c]=(0,o.useReducer)(l,i);(0,o.useEffect)(()=>{let e=localStorage.getItem("library_user"),a=localStorage.getItem("token");if(e&&a)try{let a=JSON.parse(e);c({type:"LOGIN_SUCCESS",payload:a})}catch(e){localStorage.removeItem("library_user"),localStorage.removeItem("token")}},[]);let y=async(e,a)=>{c({type:"LOGIN_START"});try{let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:a})}),t=await r.json();if(r.ok){let e={...t.user,permissions:d(t.user.role)};c({type:"LOGIN_SUCCESS",payload:e}),localStorage.setItem("library_user",JSON.stringify(e)),localStorage.setItem("token",t.token),s.ZP.success("Welcome back, ".concat(e.name,"!"))}else c({type:"LOGIN_FAILURE",payload:t.error||"Login failed"}),s.ZP.error(t.error||"Login failed")}catch(e){c({type:"LOGIN_FAILURE",payload:"Login failed. Please try again."}),s.ZP.error("Login failed. Please try again.")}},p=async function(e,a,r){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"MEMBER";c({type:"LOGIN_START"});try{let o=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:a,password:r,role:t})}),n=await o.json();if(o.ok){let e={...n.user,permissions:d(n.user.role)};c({type:"LOGIN_SUCCESS",payload:e}),localStorage.setItem("library_user",JSON.stringify(e)),localStorage.setItem("token",n.token),s.ZP.success("Welcome, ".concat(e.name,"!"))}else c({type:"LOGIN_FAILURE",payload:n.error||"Registration failed"}),s.ZP.error(n.error||"Registration failed")}catch(e){c({type:"LOGIN_FAILURE",payload:"Registration failed. Please try again."}),s.ZP.error("Registration failed. Please try again.")}};return(0,t.jsx)(n.Provider,{value:{state:r,login:y,register:p,logout:()=>{c({type:"LOGOUT"}),localStorage.removeItem("library_user"),localStorage.removeItem("token"),s.ZP.success("Logged out successfully")},clearError:()=>{c({type:"CLEAR_ERROR"})},hasPermission:e=>!!r.user&&(!!r.user.permissions.includes("all")||r.user.permissions.includes(e))},children:a})},y=()=>{let e=(0,o.useContext)(n);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},700:function(e,a,r){r.d(a,{LibraryProvider:function(){return c},y:function(){return y}});var t=r(7437),o=r(2265),s=r(9064);let n=(0,o.createContext)(null),i={books:[],members:[],borrowings:[],reservations:[],attendance:[],currentUser:null,loading:!1,error:null},l=(e,a)=>{switch(a.type){case"SET_LOADING":return{...e,loading:a.payload};case"SET_ERROR":return{...e,error:a.payload};case"SET_BOOKS":return{...e,books:a.payload};case"ADD_BOOK":return{...e,books:[...e.books,a.payload]};case"UPDATE_BOOK":return{...e,books:e.books.map(e=>e.id===a.payload.id?a.payload:e)};case"DELETE_BOOK":return{...e,books:e.books.filter(e=>e.id!==a.payload)};case"SET_MEMBERS":return{...e,members:a.payload};case"ADD_MEMBER":return{...e,members:[...e.members,a.payload]};case"UPDATE_MEMBER":return{...e,members:e.members.map(e=>e.id===a.payload.id?a.payload:e)};case"DELETE_MEMBER":return{...e,members:e.members.filter(e=>e.id!==a.payload)};case"SET_BORROWINGS":return{...e,borrowings:a.payload};case"ADD_BORROWING":return{...e,borrowings:[...e.borrowings,a.payload]};case"RETURN_BOOK":return{...e,borrowings:e.borrowings.map(e=>e.id===a.payload.id?a.payload:e)};case"SET_RESERVATIONS":return{...e,reservations:a.payload};case"ADD_RESERVATION":return{...e,reservations:[...e.reservations,a.payload]};case"SET_ATTENDANCE":return{...e,attendance:a.payload};case"ADD_ATTENDANCE":return{...e,attendance:[...e.attendance,a.payload]};case"SET_CURRENT_USER":return{...e,currentUser:a.payload};default:return e}},d=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=localStorage.getItem("token"),t=await fetch(e,{...a,headers:{"Content-Type":"application/json",...r&&{Authorization:"Bearer ".concat(r)},...a.headers}});if(!t.ok){let e=await t.json();throw console.error("API Error:",e),Error(e.error||"API call failed")}return t.json()},c=e=>{let{children:a}=e,[r,c]=(0,o.useReducer)(l,i),y=async()=>{try{c({type:"SET_LOADING",payload:!0});let e=await d("/api/books");c({type:"SET_BOOKS",payload:e.books||e})}catch(e){console.error("Error fetching books:",e),c({type:"SET_ERROR",payload:"Failed to fetch books"}),s.ZP.error("Failed to fetch books")}finally{c({type:"SET_LOADING",payload:!1})}},p=async()=>{try{var e;c({type:"SET_LOADING",payload:!0});let a=await d("/api/persons?limit=100"),r=(null===(e=a.persons)||void 0===e?void 0:e.map(e=>({id:e.id,name:e.name,email:e.email,phone:e.phone||"",address:e.address||"",membershipDate:e.membershipDate||e.createdAt,status:"ACTIVE"===e.status?"ACTIVE":"INACTIVE",personType:e.personType,createdAt:e.createdAt,updatedAt:e.updatedAt})))||[];c({type:"SET_MEMBERS",payload:r})}catch(e){console.error("Error fetching members:",e),c({type:"SET_ERROR",payload:"Failed to fetch members"}),s.ZP.error("Failed to fetch members")}finally{c({type:"SET_LOADING",payload:!1})}},u=async()=>{try{c({type:"SET_LOADING",payload:!0});let e=await d("/api/borrowings");c({type:"SET_BORROWINGS",payload:e.borrowings||e})}catch(e){console.error("Error fetching borrowings:",e),c({type:"SET_ERROR",payload:"Failed to fetch borrowings"}),s.ZP.error("Failed to fetch borrowings")}finally{c({type:"SET_LOADING",payload:!1})}},E=async()=>{try{c({type:"SET_LOADING",payload:!0});let e=await d("/api/reservations");c({type:"SET_RESERVATIONS",payload:e.reservations||e})}catch(e){console.error("Error fetching reservations:",e),c({type:"SET_ERROR",payload:"Failed to fetch reservations"}),s.ZP.error("Failed to fetch reservations")}finally{c({type:"SET_LOADING",payload:!1})}},m=async()=>{try{c({type:"SET_LOADING",payload:!0});let e=await d("/api/attendance");c({type:"SET_ATTENDANCE",payload:e.attendance||e})}catch(e){console.error("Error fetching attendance:",e),c({type:"SET_ERROR",payload:"Failed to fetch attendance"}),s.ZP.error("Failed to fetch attendance")}finally{c({type:"SET_LOADING",payload:!1})}};return(0,t.jsx)(n.Provider,{value:{state:r,dispatch:c,addBook:async e=>{try{c({type:"SET_LOADING",payload:!0}),console.log("Adding book with data:",e);let a=await d("/api/books",{method:"POST",body:JSON.stringify(e)});c({type:"ADD_BOOK",payload:a}),s.ZP.success("Book added successfully!")}catch(e){var a,r;if(console.error("Error adding book:",e),!(null===(a=e.message)||void 0===a?void 0:a.includes("already exists"))&&!(null===(r=e.message)||void 0===r?void 0:r.includes("already exists"))){let a=e.message||"Failed to add book";s.ZP.error(a)}throw e}finally{c({type:"SET_LOADING",payload:!1})}},updateBook:async e=>{try{c({type:"SET_LOADING",payload:!0});let a=await d("/api/books/".concat(e.id),{method:"PUT",body:JSON.stringify(e)});c({type:"UPDATE_BOOK",payload:a}),s.ZP.success("Book updated successfully!")}catch(e){console.error("Error updating book:",e),s.ZP.error("Failed to update book")}finally{c({type:"SET_LOADING",payload:!1})}},deleteBook:async e=>{try{c({type:"SET_LOADING",payload:!0}),await d("/api/books/".concat(e),{method:"DELETE"}),c({type:"DELETE_BOOK",payload:e}),s.ZP.success("Book deleted successfully!")}catch(e){console.error("Error deleting book:",e),s.ZP.error("Failed to delete book")}finally{c({type:"SET_LOADING",payload:!1})}},addMember:async e=>{try{c({type:"SET_LOADING",payload:!0});let a={name:e.name,email:e.email,phone:e.phone,address:e.address,personType:e.personType||"MEMBER",status:"ACTIVE"},r=await d("/api/persons",{method:"POST",body:JSON.stringify(a)}),t={id:r.id,name:r.name,email:r.email,phone:r.phone||"",address:r.address||"",membershipDate:r.membershipDate||r.createdAt,status:"ACTIVE"===r.status?"ACTIVE":"INACTIVE",createdAt:r.createdAt,updatedAt:r.updatedAt};c({type:"ADD_MEMBER",payload:t}),s.ZP.success("Member added successfully!")}catch(e){var a,r;throw console.error("Error adding member:",e),(null===(a=e.message)||void 0===a?void 0:a.includes("already exists"))||(null===(r=e.message)||void 0===r?void 0:r.includes("already exists"))||s.ZP.error("Failed to add member"),e}finally{c({type:"SET_LOADING",payload:!1})}},updateMember:async e=>{try{c({type:"SET_LOADING",payload:!0});let a={name:e.name,email:e.email,phone:e.phone,address:e.address,personType:"MEMBER",status:"ACTIVE"===e.status?"ACTIVE":"INACTIVE"},r=await d("/api/persons/".concat(e.id),{method:"PUT",body:JSON.stringify(a)}),t={id:r.id,name:r.name,email:r.email,phone:r.phone||"",address:r.address||"",membershipDate:r.membershipDate||r.createdAt,status:"ACTIVE"===r.status?"ACTIVE":"INACTIVE",createdAt:r.createdAt,updatedAt:r.updatedAt};c({type:"UPDATE_MEMBER",payload:t}),s.ZP.success("Member updated successfully!")}catch(e){console.error("Error updating member:",e),s.ZP.error("Failed to update member")}finally{c({type:"SET_LOADING",payload:!1})}},deleteMember:async e=>{try{c({type:"SET_LOADING",payload:!0}),await d("/api/persons/".concat(e),{method:"DELETE"}),c({type:"DELETE_MEMBER",payload:e}),s.ZP.success("Member deleted successfully!")}catch(e){console.error("Error deleting member:",e),s.ZP.error("Failed to delete member")}finally{c({type:"SET_LOADING",payload:!1})}},borrowBook:async e=>{try{c({type:"SET_LOADING",payload:!0});let a=await d("/api/borrowings",{method:"POST",body:JSON.stringify(e)});c({type:"ADD_BORROWING",payload:a}),s.ZP.success("Book borrowed successfully!")}catch(e){var a,r;throw console.error("Error borrowing book:",e),(null===(a=e.message)||void 0===a?void 0:a.includes("already"))||(null===(r=e.message)||void 0===r?void 0:r.includes("not found"))||s.ZP.error("Failed to borrow book"),e}finally{c({type:"SET_LOADING",payload:!1})}},returnBook:async e=>{try{c({type:"SET_LOADING",payload:!0});let a=await d("/api/borrowings/".concat(e),{method:"PUT",body:JSON.stringify({action:"return"})});c({type:"RETURN_BOOK",payload:a}),s.ZP.success("Book returned successfully!")}catch(e){console.error("Error returning book:",e),s.ZP.error("Failed to return book")}finally{c({type:"SET_LOADING",payload:!1})}},addReservation:async e=>{try{c({type:"SET_LOADING",payload:!0});let a=await d("/api/reservations",{method:"POST",body:JSON.stringify(e)});c({type:"ADD_RESERVATION",payload:a}),s.ZP.success("Book reserved successfully!")}catch(e){var a,r;throw console.error("Error adding reservation:",e),(null===(a=e.message)||void 0===a?void 0:a.includes("already"))||(null===(r=e.message)||void 0===r?void 0:r.includes("not found"))||s.ZP.error("Failed to reserve book"),e}finally{c({type:"SET_LOADING",payload:!1})}},addAttendance:async e=>{try{c({type:"SET_LOADING",payload:!0});let a={action:"check-in",personId:e.personId,memberId:e.memberId,visitorName:e.visitorName,visitorEmail:e.visitorEmail,visitorPhone:e.visitorPhone},r=await d("/api/attendance",{method:"POST",body:JSON.stringify(a)});c({type:"ADD_ATTENDANCE",payload:r}),s.ZP.success("Attendance recorded successfully!")}catch(e){var a,r;throw console.error("Error adding attendance:",e),(null===(a=e.message)||void 0===a?void 0:a.includes("already"))||(null===(r=e.message)||void 0===r?void 0:r.includes("already checked in"))||s.ZP.error("Failed to record attendance"),e}finally{c({type:"SET_LOADING",payload:!1})}},getRecommendations:e=>{let a=r.borrowings.filter(a=>a.memberId===e).map(e=>r.books.find(a=>a.id===e.bookId)).filter(Boolean),t=a.map(e=>e.category),o=t.sort((e,a)=>t.filter(a=>a===e).length-t.filter(e=>e===a).length).pop();return r.books.filter(e=>e.category===o&&!a.some(a=>a.id===e.id)&&"AVAILABLE"===e.status).slice(0,3)},fetchBooks:y,fetchMembers:p,fetchBorrowings:u,fetchReservations:E,fetchAttendance:m},children:a})},y=()=>{let e=(0,o.useContext)(n);if(!e)throw Error("useLibrary must be used within a LibraryProvider");return e}},9124:function(e,a,r){r.d(a,{NotificationProvider:function(){return d},z:function(){return c}});var t=r(7437),o=r(2265),s=r(9064);let n=(0,o.createContext)(null),i={notifications:[],unreadCount:0},l=(e,a)=>{switch(a.type){case"ADD_NOTIFICATION":let r={...a.payload,id:Date.now().toString(),timestamp:new Date,read:!1};return{...e,notifications:[r,...e.notifications],unreadCount:e.unreadCount+1};case"MARK_AS_READ":return{...e,notifications:e.notifications.map(e=>e.id===a.payload?{...e,read:!0}:e),unreadCount:Math.max(0,e.unreadCount-1)};case"MARK_ALL_AS_READ":return{...e,notifications:e.notifications.map(e=>({...e,read:!0})),unreadCount:0};case"REMOVE_NOTIFICATION":let t=e.notifications.find(e=>e.id===a.payload);return{...e,notifications:e.notifications.filter(e=>e.id!==a.payload),unreadCount:t&&!t.read?Math.max(0,e.unreadCount-1):e.unreadCount};case"CLEAR_ALL_NOTIFICATIONS":return{...e,notifications:[],unreadCount:0};default:return e}},d=e=>{let{children:a}=e,[r,d]=(0,o.useReducer)(l,i);return(0,o.useEffect)(()=>{let e=localStorage.getItem("library_notifications");if(e)try{JSON.parse(e).forEach(e=>{d({type:"ADD_NOTIFICATION",payload:e})})}catch(e){localStorage.removeItem("library_notifications")}},[]),(0,o.useEffect)(()=>{localStorage.setItem("library_notifications",JSON.stringify(r.notifications))},[r.notifications]),(0,t.jsx)(n.Provider,{value:{state:r,addNotification:e=>{switch(d({type:"ADD_NOTIFICATION",payload:e}),e.type){case"success":s.ZP.success(e.message);break;case"error":s.ZP.error(e.message);break;case"warning":(0,s.ZP)(e.message,{icon:"⚠️"});break;default:(0,s.ZP)(e.message)}},markAsRead:e=>{d({type:"MARK_AS_READ",payload:e})},markAllAsRead:()=>{d({type:"MARK_ALL_AS_READ"})},removeNotification:e=>{d({type:"REMOVE_NOTIFICATION",payload:e})},clearAllNotifications:()=>{d({type:"CLEAR_ALL_NOTIFICATIONS"})}},children:a})},c=()=>{let e=(0,o.useContext)(n);if(!e)throw Error("useNotifications must be used within a NotificationProvider");return e}}}]);